<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003" >

  <PropertyGroup>
    <Configuration>Debug</Configuration>
    <OutDir>$(RootDir)obj\tests\OutDirSupport\withNuspecDependencies\</OutDir>

    <testPackageVersion Condition="'$(testPackageVersion)' == ''">0.0.2-pre</testPackageVersion>
    <testPackageVersion Condition="'$(NugetPackageVersion)' != ''">$(NugetPackageVersion)</testPackageVersion>

    <expectedPackage Condition="'$(expectedPackage)'==''">$(OutDir)$(Configuration)\NugetPackages\sample.$(testPackageVersion).nupkg</expectedPackage>
    <expectedPackageExtractedPath>$(OutDir)$(Configuration)\NugetPackages\sample.$(testPackageVersion)</expectedPackageExtractedPath>
  </PropertyGroup>

  <Import Project="$(TestsRoot)test.SinglePackage.import"/>

  <Target Name="Test">
    <MSBuild Projects="$(projectToRun)" Targets="$(targetToRun)" Properties="OutDir=$(OutDir)" />
  </Target>

  <Target Name="Assert">

    <ItemGroup>
      <notExpectedFiles Include="project.proj"/>
      <notExpectedFiles Include="Properties/build.props"/>
    </ItemGroup>

    <Error Text="> Assert: Not expected file '%(notExpectedFiles.Identity)' is inside extracted package folder '$(expectedPackage)' !"
           Condition="Exists('$(expectedPackageExtractedPath)/%(notExpectedFiles.Filename)%(Extension)') == 'true'"/>

  </Target>

</Project>
